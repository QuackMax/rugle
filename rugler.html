<!DOCTYPE html>
<html lang="en-US">
 
<head>
    <title class="notranslate">Search Google without the language barrier</title>

	<script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script> 

	<script>	
		let translator;
		
		async function fetch_languages()
		{
			const res = await fetch("https://raw.githubusercontent.com/QuackMax/rugle/QuackMax-googletranslate/supportedLanguages.json")			
			return (await res.json())
		}

		function update_dropdown(strName, langs)	
		{
			let dropdown = document.getElementById(strName);
			dropdown.length = 0;

			let option;
					
			for (let i = 0; i < langs.length; i++) 
			{
			  option = document.createElement('option');
			  option.text = langs[i].name;
			  option.value = langs[i].language;
			  dropdown.add(option);
			}
			
			dropdown.selectedIndex = 0;
		}

		function update_dropdowns()
		{
			fetch_languages().then(
				json =>
				{
					update_dropdown('from_language_dropdown', json["sourceLanguages"]);
				}
			);
		}
		
		function googleTranslateElementInit() {
			var from_lang = document.getElementById('from_language_dropdown').value;
			
			translator = new google.translate.TranslateElement({pageLanguage: from_lang}, 'google_translate_element');
		}
		
		function googleSwitchFromPageLanguage()
		{
			<!-- This is a gross trick -- inspecting translator shows that aa is the right parameter for pageLanguage. --!>
			<!-- A documented variable or function call would be infinitely more desireable --!>
			translator.aa = document.getElementById('from_language_dropdown').value;
		}
		
		function search_retranslate()
		{
			var translated_search_terms = document.getElementById('translated_search_terms').value;
			var from_lang = document.getElementById('from_language_dropdown').value;
			<!-- This is a gross trick -- inspecting translator shows that R is the right parameter for selected language. --!>
			<!-- A documented variable or function call would be infinitely more desireable --!>
			var to_lang = translator.R;
			
			window.location.href='https://www-google-com.translate.goog/search?hl=' + 
				to_lang + '&q=' + translated_search_terms + 
				'&_x_tr_sl=' + to_lang + '&_x_tr_tl=' + from_lang + '&_x_tr_pto=wapp';
		}
		
		function copyToTranslateBox()
		{
			var search_terms = document.getElementById('search_terms').value;
			document.getElementById('translated_search_terms').value = search_terms;
		}
	</script>
</head>
 
<body onload="update_dropdowns();">


<form action="javascript:search_retranslate()" method="GET">
	<table>
	<tbody>
	  <tr>
		<td><label for="from_language_dropdown" class="notranslate">From</label></td>
		<td><select id="from_language_dropdown" name="from_language" class="notranslate" onchange="googleTranslateElementInit();"></select></td>
		<td><input type="text" id="search_terms" name="search_terms" class="notranslate" onfocusout="copyToTranslateBox()"></td>
		<td></td>
	  </tr>
	  <tr>
		<td><label for="google_translate_element" class="notranslate">To</label></td>
		<td><div id="google_translate_element" style="display: inline-block;"></div></td>
		<td><input type="text" id="translated_search_terms" name="translated_search_terms" class="translate"></td>
		<td><input type="submit" value="Search" class="notranslate"></td>
	  </tr>
	</tbody>
	</table>
</form>

</body> 
 
</html>
